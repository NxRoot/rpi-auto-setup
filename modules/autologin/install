#!/bin/bash
# Toggle console auto-login for Raspberry Pi (Debian-based)
# Works with systemd on Raspberry Pi OS, Ubuntu, etc.

VALUE=${3:-on}
USER=$(who -m | awk '{ print $1 }')
SERVICE="getty@tty1.service"
SERVICE_DIR="/etc/systemd/system/${SERVICE}.d"
SERVICE_FILE="${SERVICE_DIR}/autologin.conf"

if [ -f "$SERVICE_FILE" ]; then
    sudo rm -f $SERVICE_FILE
    sudo mkdir -p $SERVICE_DIR
    echo "[Service]" > $SERVICE_FILE
    echo "ExecStart=" >> $SERVICE_FILE
    echo "ExecStart=-/sbin/agetty --autologin $USER --noclear %I \$TERM" >> $SERVICE_FILE
fi

if [ "$VALUE" = "on" ]; then
    echo "Enabled auto-login for user '${USER}'..."
    sudo systemctl enable ${SERVICE}
else
    echo "Disabled auto-login for user '${USER}'..."
    sudo systemctl disable ${SERVICE}
fi

echo "Please reboot your device for changes to take effect."
