#!/bin/bash
# Toggle console auto-login for Raspberry Pi (Debian-based)
# Works with systemd on Raspberry Pi OS, Ubuntu, etc.

VALUE=${3:-on}
USER=$(who -m | awk '{ print $1 }')

SERVICE="getty@tty1"
SERVICE_DIR="/etc/systemd/system/${SERVICE}.service.d"
SERVICE_FILE="$SERVICE_DIR/autologin.conf"

if [ -f "$SERVICE_FILE" ]; then
    sudo systemctl disable $SERVICE
    sudo rm -f $SERVICE_FILE
fi

if [ ! -d "$SERVICE_DIR" ]; then
    sudo mkdir -p $SERVICE_DIR
fi

if [ "$VALUE" = "on" ]; then
    echo "Enabled auto-login for user '${USER}'..."
    sudo echo "[Service]" > "$SERVICE_FILE"
    sudo echo "ExecStart=" >> "$SERVICE_FILE"
    sudo echo "ExecStart=-/sbin/agetty --autologin $USER --noclear %I \$TERM" >> "$SERVICE_FILE"
    sudo systemctl enable $SERVICE
else
    echo "Disabled auto-login for user '${USER}'..."
fi

echo "Please reboot your device for changes to take effect."
