#!/bin/sh

REPLACE_LINE() {
    file_content=$(<$1)
    file_content=${file_content//$2/$3}
    echo "$file_content" > $1
}

REMOVE_LINE() {
    sudo ex -s +"g/$2/d" -cwq $1
}

RESTORE() {
    if [ -f "$1.orig" ]; then
        sudo cp $1.orig $1
    elif [ -f "$1" ]; then
        sudo cp $1 $1.orig
    fi
}

TOGGLE_SERVICE() {
    if [ -f "/etc/systemd/system/$1.service" ]; then
        sudo systemctl stop $1
        sudo systemctl disable $1
        sudo rm -f /etc/systemd/system/$1.service
    else
        CREATE_SERVICE "$1" "$2"
    fi
}

CREATE_SERVICE() {
    service=/etc/systemd/system/$1.service
    sudo rm -f $service
    sudo touch $service
    echo "[Unit]" > $service
    echo "Description=$1" >> $service
    echo "After=network-online.target" >> $service
    echo "" >> $service
    echo "[Service]" >> $service
    echo "ExecStart=/bin/bash -c '$2'" >> $service
    echo "StandardOutput=inherit" >> $service
    echo "StandardError=inherit" >> $service
    echo "Restart=always" >> $service
    echo "User=pi" >> $service
    echo "Group=pi" >> $service
    echo "WorkingDirectory=/home/pi/$1" >> $service
    echo "" >> $service
    echo "[Install]" >> $service
    echo "WantedBy=multi-user.target" >> $service
    sudo systemctl enable $1
    sudo systemctl start $1
}
